#include "xc.inc"
    GLOBAL _divide_signed
    PSECT mytext ,local, class = CODE , reloc = 2;

;0x11 (???) | 0x13 ?? | | 0x15 (?) | 0x16 (???) XOR ??
;0x21 (???) | 0x23 ?? |
_divide_signed:
    MOVFF 0x01,0x11 ; ????? lowbyte ?? 0x11
    MOVFF 0x01,0x21 ; ?(??)???? lowbyte ?? 0x11
    MOVFF 0x03,0x13 ; ?  ?? ?? 0x13
    MOVFF 0x03,0x23 ; ?(??)?? ?? 0x13
    BTFSC 0x11 ,7    ; ?????????
	NEGF 0x11    ; ???????????2?? (low byte ??2??)
    BTFSC 0x13 ,7   ; ????????
	NEGF 0x13    ; ??????????2??
    MOVF 0x13,W
    CPFSLT 0x11
	GOTO start
    GOTO endDivide
start:
CLRF 0x01
CLRF 0x02
CLRF 0x03
CLRF 0x04
CLRF 0x15	       ; ?
	
LOOP:
    check:               ;???????????
    MOVF 0x13,W       ;?????WREG
    CPFSLT 0x11        ;if 0x11 (???) < 0x13 (??) ?????? ?????????
	GOTO DIVIDE    ;if 0x13 <= 0x01 ??????????????
    GOTO endDivide     ;??????????????
    
    DIVIDE:             ;?????
	MOVF 0x13,W    ;?????WREG
	SUBWF 0x11,F   ;????? lowbyte - ?? ????0x11
	INCF 0x15        ;???
	GOTO LOOP       ;??loop
	
endDivide:                ;??
    BTFSC 0x21,7        ;0x21 (???)?????
	NEGF 0x11       ;0x11 (??)?2?? 
    MOVF 0x21,W        ;?0x22 (???)
    XORWF 0x23,W       ;??? ?exclusive or
    MOVWF 0x16         ;?exclusive or?????0x16
    BTFSC 0x16,7        ; ?????
	NEGF 0x15        ;???????
    MOVFF 0x11,0x01    ;????0x01(res ? HIGH byte)
    MOVFF 0x15,0x02    ;?? ??0x02
    
RETURN
